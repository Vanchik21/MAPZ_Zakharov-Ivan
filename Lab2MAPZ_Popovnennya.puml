@startuml
|Клієнт|
start
:Ініціювати поповнення рахунку;
:Ввести бажану суму;
:Обрати метод оплати (напр., картка);

|Система|
:Створити об'єкт Транзакція (TransactionID, UserID, Amount, Status='Pending');
:Перенаправити клієнта на сторінку платіжного шлюзу;

|Платіжний шлюз|
:Відобразити платіжну форму;
:Отримати та обробити платіжні дані клієнта (номер картки, CVV);
if (Чи валідні дані та достатньо коштів на картці?) then (так, успішно)
  :Провести транзакцію;
  :Надіслати підтвердження (callback) системі;
  
  |Система|
  :Отримати підтвердження від шлюзу;
  :Оновити статус об'єкта Транзакція на 'Completed';
  
  |База даних|
  :Збільшити баланс користувача на суму транзакції;
  :Зберегти фінальний стан транзакції в БД;
  
  |Система|
  :Повідомити клієнта про успішне поповнення;
  
  |Клієнт|
  :Отримати сповіщення та побачити оновлений баланс;
  
else (ні, помилка)
  |Платіжний шлюз|
  :Надіслати повідомлення про помилку (callback) системі;

  |Система|
  :Отримати повідомлення про помилку;
  :Оновити статус об'єкта Транзакція на 'Failed';
  
  |База даних|
  :Зберегти невдалу транзакцію в БД для історії;
  
  |Система|
  :Повідомити клієнта про невдалу спробу оплати;
  
  |Клієнт|
  :Отримати повідомлення про помилку;
endif

stop
@enduml